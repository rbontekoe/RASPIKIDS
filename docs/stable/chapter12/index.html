<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>12 Stroom- en gasverbruik op het dashboard weergeven · RASPIKIDS</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="RASPIKIDS logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">RASPIKIDS</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Toepassingen met de Raspberry Pi</a></li><li><a class="tocitem" href="../blog/">Blog</a></li><li><span class="tocitem">Sectie 1 - Basis installaties</span><ul><li><a class="tocitem" href="../chapter1/">1 Micro SD-kaartje klaarmaken voor de Raspberry Pi 3B+</a></li><li><a class="tocitem" href="../chapter2/">2 Communiceren met de Raspberry Pi</a></li><li><a class="tocitem" href="../chapter3/">3 Docker installeren</a></li><li><a class="tocitem" href="../chapter4/">4 Portainer installeren</a></li><li><a class="tocitem" href="../chapter5/">5 Node-RED installeren</a></li></ul></li><li><span class="tocitem">Sectie 2 - Algemene Node-RED toepassingen</span><ul><li><a class="tocitem" href="../chapter6/">6 Website bouwen met Node-RED</a></li></ul></li><li><span class="tocitem">Sectie 3 - Sensoren</span><ul><li><a class="tocitem" href="../chapter7/">7 MQTT broker installeren</a></li><li><a class="tocitem" href="../chapter8/">8 Temperatuur meten</a></li><li><a class="tocitem" href="../chapter9/">9 Node-RED dashboard programma maken</a></li></ul></li><li><span class="tocitem">Sectie 4 - Slimme meter</span><ul><li><a class="tocitem" href="../chapter10/">10 Domoticz installeren</a></li><li><a class="tocitem" href="../chapter11/">11 Slimme meter aansluiten</a></li><li class="is-active"><a class="tocitem" href>12 Stroom- en gasverbruik op het dashboard weergeven</a><ul class="internal"><li><a class="tocitem" href="#Wat-je-nodig-hebt"><span>Wat je nodig hebt</span></a></li><li><a class="tocitem" href="#Wat-je-gaat-doen"><span>Wat je gaat doen</span></a></li><li><a class="tocitem" href="#Stap-1-Domoticz-gegevens-aan-de-MQTT-broker-doorgeven"><span>Stap 1 - Domoticz gegevens aan de MQTT broker doorgeven</span></a></li><li><a class="tocitem" href="#Stap-2-Domoticz-gegevens-op-het-Dashboard-weergegeven"><span>Stap 2 - Domoticz gegevens op het Dashboard weergegeven</span></a></li><li><a class="tocitem" href="#Samenvatting"><span>Samenvatting</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../appendix/">Bijlage</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Sectie 4 - Slimme meter</a></li><li class="is-active"><a href>12 Stroom- en gasverbruik op het dashboard weergeven</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>12 Stroom- en gasverbruik op het dashboard weergeven</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/rbontekoe/RASPIKIDS/blob/master/docs/src/chapter12.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Stroom-en-gasverbruik-op-het-dashboard-weergeven"><a class="docs-heading-anchor" href="#Stroom-en-gasverbruik-op-het-dashboard-weergeven">Stroom- en gasverbruik op het dashboard weergeven</a><a id="Stroom-en-gasverbruik-op-het-dashboard-weergeven-1"></a><a class="docs-heading-anchor-permalink" href="#Stroom-en-gasverbruik-op-het-dashboard-weergeven" title="Permalink"></a></h1><p><em>We willen de gegevens over hoeveel stroom en gas we verbruiken willen laten zien op het Dashboard.</em></p><h3 id="Inhoud"><a class="docs-heading-anchor" href="#Inhoud">Inhoud</a><a id="Inhoud-1"></a><a class="docs-heading-anchor-permalink" href="#Inhoud" title="Permalink"></a></h3><ul><li><a href="../chapter11/#Slimme-meter-aansluitengeïnstalleerd">Slimme meter aansluitengeïnstalleerd</a></li><li class="no-marker"><ul><li><a href="../chapter11/#Wat-je-nodig-hebt">Wat je nodig hebt</a></li><li><a href="../chapter11/#Wat-je-gaat-doen">Wat je gaat doen</a></li><li><a href="../chapter11/#Samenvatting">Samenvatting</a></li></ul></li></ul><h2 id="Wat-je-nodig-hebt"><a class="docs-heading-anchor" href="#Wat-je-nodig-hebt">Wat je nodig hebt</a><a id="Wat-je-nodig-hebt-1"></a><a class="docs-heading-anchor-permalink" href="#Wat-je-nodig-hebt" title="Permalink"></a></h2><ul><li>Een Raspberry Pi 3B+ met het besturingssysteem Ubuntu Server 22.04.</li><li>Docker, Portainer, Domoticz en Node-RED zijn geïnstalleerd.</li><li>De Raspberry Pi heeft verbinding met het Internet.</li></ul><h2 id="Wat-je-gaat-doen"><a class="docs-heading-anchor" href="#Wat-je-gaat-doen">Wat je gaat doen</a><a id="Wat-je-gaat-doen-1"></a><a class="docs-heading-anchor-permalink" href="#Wat-je-gaat-doen" title="Permalink"></a></h2><p>Stap 1: Domoticz gegevens aan de MQTT broker doorgeven.</p><p>Stap 2: Domoticz gegevens op het Dashboard weergegeven.</p><h2 id="Stap-1-Domoticz-gegevens-aan-de-MQTT-broker-doorgeven"><a class="docs-heading-anchor" href="#Stap-1-Domoticz-gegevens-aan-de-MQTT-broker-doorgeven">Stap 1 - Domoticz gegevens aan de MQTT broker doorgeven</a><a id="Stap-1-Domoticz-gegevens-aan-de-MQTT-broker-doorgeven-1"></a><a class="docs-heading-anchor-permalink" href="#Stap-1-Domoticz-gegevens-aan-de-MQTT-broker-doorgeven" title="Permalink"></a></h2><p>Soms wil je misschien weten hoeveel gas en elektriciteit je gebruikt. Om deze informatie te krijgen, kun je deze ook naar onze &quot;MQTT broker&quot; sturen. Je hebt een speciale instelling in Domoticz nodig die een &quot;MQTT client gateway with LAN interface&quot; heet. Die ervoor zorgt dat de informatie naar de MQTT broker wordt gestuurd.</p><ol><li>Type in de adresbalk van je browser <code>IP_adres_Raspberry_Pi:8081</code> en druk op &quot;Enter&quot;. Je ziet nu het beginscherm van Domoticz.</li><li>Log in met de naam &quot;admin&quot; en het wachtwoord &quot;domoticz&quot;.</li><li>Klik op de tab &quot;Setup&quot; en kies dan &quot;Hardware&quot;.</li><li>Druk op de knop &quot;Add&quot; die onderaan de pagina staat. <span>$\\$</span><img src="../assets/fig_12_1.png" alt="fig_12_1"/> <span>$\\$</span> Vul de volgende waarden in:  <span>$\\$</span> Enabled: Aan  <span>$\\$</span> Name: mqtt <span>$\\$</span> Type: selecteer &quot;MQTT client with LAN interfase&quot;  <span>$\\$</span> Remote Address: <code>IP_adres_Raspberry_Pi</code> <span>$\\$</span> Port: 1883 <span>$\\$</span> Prevent Loop: True <span>$\\$</span> Publish Topic: Flat <span>$\\$</span> Topic Out Prefix: domoticz/out <span>$\\$</span> TLS Version: tlsv1.2</li><li>Druk op de toets &quot;Update&quot; bovenaan de pagina.</li></ol><h2 id="Stap-2-Domoticz-gegevens-op-het-Dashboard-weergegeven"><a class="docs-heading-anchor" href="#Stap-2-Domoticz-gegevens-op-het-Dashboard-weergegeven">Stap 2 - Domoticz gegevens op het Dashboard weergegeven</a><a id="Stap-2-Domoticz-gegevens-op-het-Dashboard-weergegeven-1"></a><a class="docs-heading-anchor-permalink" href="#Stap-2-Domoticz-gegevens-op-het-Dashboard-weergegeven" title="Permalink"></a></h2><p>Eerder heb je geleerd hoe je informatie op een Dashboard kunt laten zien. Dit is als een magische plek waar je alle gegevens kunt verzamelen die je naar de &quot;MQTT broker&quot; hebt gestuurd.</p><ol><li>Stel de volgende flows op: <span>$\\$</span><img src="../assets/fig_12_2.png" alt="fig_12_2"/></li><li>Kies &quot;domoticz/out&quot; als het onderwerp waarover je informatie wilt verzamelen.</li><li>Gebruik de code uit deze link voor <a href="#JavaScript-code-functie-9">functie 9</a>. Dit is als een speciaal stukje code dat ervoor zorgt dat de informatie wordt opgehaald en op de juiste manier wordt weergegeven.</li><li>Gebruik de code uit deze link voor <a href="#JavaScript-code-functie-10">functie 10</a>. Dit zorgt ervoor dat de informatie wordt opgehaald en weergegeven op de juiste plek.</li><li>Voor &quot;Electra momenteel&quot; moet je deze instellingen gebruiken: <span>$\\$</span><img src="../assets/fig_12_3.png" alt="fig_12_3"/></li><li>Voor &quot;Gas per 1-1-2023&quot; moet je deze instellingen gebruiken:  <span>$\\$</span><img src="../assets/fig_12_4.png" alt="fig_12_4"/></li></ol><h3 id="JavaScript-code-functie-9"><a class="docs-heading-anchor" href="#JavaScript-code-functie-9">JavaScript code functie 9</a><a id="JavaScript-code-functie-9-1"></a><a class="docs-heading-anchor-permalink" href="#JavaScript-code-functie-9" title="Permalink"></a></h3><pre><code class="nohighlight hljs">var myval = msg.payload;
if (myval.name == &#39;Power&#39;) {
  msg.payload.value = Number(myval.svalue5);
  return msg;
}</code></pre><p>De informatie die je krijgt, gaat altijd over wat er op dat moment gebeurt. Als je kijkt naar hoeveel stroom je gebruikt, zie je altijd hoeveel stroom je op dat moment verbruikt. En als je een apparaat uitzet, zie je het verschil in het stroomverbruik en weet je dus hoeveel Watt dat apparaat gebruikt.</p><h3 id="JavaScript-code-functie-10"><a class="docs-heading-anchor" href="#JavaScript-code-functie-10">JavaScript code functie 10</a><a id="JavaScript-code-functie-10-1"></a><a class="docs-heading-anchor-permalink" href="#JavaScript-code-functie-10" title="Permalink"></a></h3><pre><code class="nohighlight hljs">let myvalNew = msg.payload;
let myvalOld = 0;
let myvalStart = 3050.00;

if (myvalNew.name == &#39;Gas&#39;) {
  
  msg.payload = ((Number(myvalNew.svalue1-myvalOld)/1000) - myvalStart).toFixed(2);
  myvalOld = myvalNew.svalue1;
  return msg;

}</code></pre><p>Bij het gasverbruik krijg je de totale hoeveelheid die is gebruikt, dus vanaf het begin. Daarom moet je de beginwaarde &quot;myvalStart&quot; ervan aftrekken om te weten hoeveel gas er sinds dat moment is gebruikt.</p><h2 id="Samenvatting"><a class="docs-heading-anchor" href="#Samenvatting">Samenvatting</a><a id="Samenvatting-1"></a><a class="docs-heading-anchor-permalink" href="#Samenvatting" title="Permalink"></a></h2><p>Deze les gaat over hoe je op een Dashboard kan zien hoeveel stroom en gas je verbruikt. Hiervoor heb je een Raspberry Pi 3B+ nodig met het besturingssysteem Ubuntu Server 22.04 en een aantal programma&#39;s zoals Docker, Portainer, Domoticz en Node-RED. Je moet ervoor zorgen dat de gegevens van Domoticz naar de &quot;MQTT broker&quot; worden gestuurd. Daarna kan je deze informatie ophalen en op de juiste manier weergeven op het Dashboard. Als je bijvoorbeeld kijkt naar hoeveel stroom je op dat moment verbruikt, dan zie je dat op het Dashboard. Bij het gasverbruik krijg je de totale hoeveelheid die is gebruikt, dus vanaf het begin. Daarom moet je de beginwaarde van het gasverbruik aftrekken om te weten hoeveel gas er sinds dat moment is gebruikt.</p><p>Ik heb nog de post <a href="../blog/#03-2023-Temperatuur-van-de-huiskamer-in-Domoticz-weergeven"><strong>Temperatuur van de huiskamer in Domoticz weergeven</strong></a> aan de blog toegevoegd!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../chapter11/">« 11 Slimme meter aansluiten</a><a class="docs-footer-nextpage" href="../appendix/">Bijlage »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 6 July 2023 16:09">Thursday 6 July 2023</span>. Using Julia version 1.8.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
